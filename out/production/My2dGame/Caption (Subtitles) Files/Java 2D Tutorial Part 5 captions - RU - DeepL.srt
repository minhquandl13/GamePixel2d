1
00:00:00,320 --> 00:00:05,920
Привет, ребята, это RyiSnow

2
00:00:02,399 --> 00:00:12,080
Итак, в прошлый раз нам удалось нарисовать эти фоновые плитки

4
00:00:08,400 --> 00:00:19,439
но это лишь небольшой образец карты, и ее размер соответствует размеру игрового экрана

7
00:00:16,960 --> 00:00:22,880
Если для вашей игры достаточно одного экрана, это может быть нормально.

9
00:00:22,080 --> 00:00:34,480
но то, что мы пытаемся создать, в конечном счете, в этом руководстве - это 2D экшн RPG

13
00:00:30,720 --> 00:00:35,360
поэтому мы хотим иметь большую карту

14
00:00:34,480 --> 00:00:41,840
поэтому в этом видео мы создадим карту мира и нарисуем ее на экране

16
00:00:38,480 --> 00:00:47,840
для создания карты мира я подготовил несколько дополнительных плиток

19
00:00:46,800 --> 00:00:53,520
дерево, песок и земля (грязь)

22
00:00:50,480 --> 00:00:59,840
так что давайте скопируем их в этот пакет "tiles"

25
00:01:00,160 --> 00:01:05,199
и давайте загрузим эти новые плитки

26
00:01:03,920 --> 00:01:12,880
скопируем это и добавим еще три.

39
00:01:32,159 --> 00:01:40,840
теперь мы можем использовать и эти плитки

40
00:01:35,680 --> 00:01:40,840
а это карта мира, которую я создал

41
00:01:42,159 --> 00:01:48,479
это карта размером 50 на 50 плиток

43
00:01:46,000 --> 00:01:51,119
конечно, вы можете создать свою собственную карту

44
00:01:48,479 --> 00:01:56,399
и если вы хотите создать карту большего размера, вы можете это сделать

46
00:01:52,720 --> 00:02:03,920
и перед загрузкой и рисованием этого файла карты мира, нам нужно сделать некоторые настройки

49
00:02:00,719 --> 00:02:07,280
Что мы собираемся сделать, так это отредактировать код в классе Player

50
00:02:03,920 --> 00:02:13,200
так что вместо перемещения по экрану

53
00:02:10,800 --> 00:02:17,360
персонаж игрока всегда будет отображаться в центре

55
00:02:15,840 --> 00:02:25,599
и мы расширим границы нашего цикла рисования плитки

58
00:02:22,560 --> 00:02:33,920
наша текущая система рисования плиток настроена на рисование плиток такого размера, как размер нашего экрана

61
00:02:31,040 --> 00:02:39,280
и этого недостаточно, чтобы нарисовать нашу карту мира, поэтому мы изменим ее

64
00:02:36,400 --> 00:02:46,080
и когда эти два шага выполнены, мы можем отобразить нашу карту мира и перемещаться по ней

66
00:02:42,879 --> 00:02:49,200
так что давайте перейдем к первому шагу

67
00:02:46,080 --> 00:02:52,720
давайте перейдем к этому классу Entity

68
00:02:49,200 --> 00:03:00,640
и переименуем x и y в worldX и worldY.

73
00:02:57,440 --> 00:03:03,680
как сказать... для лучшего понимания

74
00:03:00,640 --> 00:03:08,239
потому что мы будем использовать два вида x и y

76
00:03:05,120 --> 00:03:10,000
один - worldX и worldY

77
00:03:08,239 --> 00:03:15,120
а этот - screenX и screenY

79
00:03:12,800 --> 00:03:19,599
эти разные и указывают на разные координаты

81
00:03:17,200 --> 00:03:28,400
и понимание этой разницы будет ключом к пониманию механики игровой камеры

84
00:03:25,440 --> 00:03:33,360
Хорошо, тогда давайте перейдем к этому классу Player

86
00:03:30,640 --> 00:03:36,879
и переименовать эти x и y тоже

90
00:03:40,879 --> 00:03:44,000
подождите, что

93
00:03:46,400 --> 00:03:50,080
что это?

96
00:03:52,799 --> 00:03:55,280
извините

97
00:03:54,000 --> 00:04:00,040
и этот тоже

102
00:04:04,959 --> 00:04:09,120
оставим это пока

103
00:04:06,879 --> 00:04:12,640
потому что здесь мы будем использовать другой вид x и y.

107
00:04:19,919 --> 00:04:31,199
поэтому в этом классе Player переименуйте эти x и y в setDefaultValues

109
00:04:26,880 --> 00:04:31,199
а также x и y в этом методе обновления

110
00:04:32,560 --> 00:04:41,040
и эти worldX и worldY не являются положением экрана

112
00:04:37,680 --> 00:04:44,479
это не то место, где мы рисуем на экране

113
00:04:41,040 --> 00:04:47,840
это положение игрока на карте мира

115
00:04:45,759 --> 00:04:52,400
и я хочу изменить это положение игрока по умолчанию

117
00:04:50,320 --> 00:04:54,160
так что это будет отправной точкой

119
00:04:54,160 --> 00:05:01,759
Я хочу начать игру в этой точке

122
00:04:59,919 --> 00:05:13,520
так что это будет... 23 

127
00:05:08,840 --> 00:05:18,080
поэтому вместо этих 100 100 мы напечатаем...

135
00:05:29,440 --> 00:05:36,240
это будет начальная позиция

136
00:05:33,120 --> 00:05:40,639
затем в этом классе Player мы создаем еще одну переменную x и y

146
00:05:54,160 --> 00:06:02,960
так что теперь у нас есть worldX, worldY и screenX, screenY

149
00:06:00,560 --> 00:06:11,440
и screenX и screenY указывают, где мы рисуем игрока на экране

152
00:06:08,319 --> 00:06:19,520
Итак, мы помещаем персонажа игрока в центр экрана и прокручиваем фон по мере его движения

155
00:06:17,039 --> 00:06:21,840
вот что мы будем делать

167
00:06:44,000 --> 00:06:52,479
так что это возвращает точку на полпути экрана

169
00:06:50,319 --> 00:06:58,560
Так что когда мы нарисуем этого персонажа игрока,

171
00:06:55,199 --> 00:07:08,160
вместо этих x и y давайте заменим их на screenX и screenY

175
00:07:04,800 --> 00:07:13,280
эти screenX и screenY не меняются на протяжении всей игры

177
00:07:10,639 --> 00:07:17,440
это "конечные" переменные

179
00:07:15,360 --> 00:07:22,319
чтобы положение персонажа игрока на экране не менялось

181
00:07:20,880 --> 00:07:26,319
хорошо, давайте проверим это

185
00:07:27,599 --> 00:07:35,840
теперь позиция игрока фиксирована в центре экрана или...

188
00:07:34,000 --> 00:07:42,080
на самом деле, это не центр экрана

191
00:07:39,039 --> 00:07:46,639
эти две переменные точно указывают на центр экрана

193
00:07:44,639 --> 00:07:57,360
но проблема в том, что эти координаты используются для левого верхнего угла изображения

198
00:07:56,319 --> 00:08:03,280
поэтому нам нужно сделать небольшую корректировку

200
00:08:00,080 --> 00:08:06,720
из этого значения мы вычтем...

204
00:08:10,400 --> 00:08:17,120
и это тоже

205
00:08:13,759 --> 00:08:17,120
Хорошо, давайте проверим

207
00:08:19,520 --> 00:08:22,720
Вы видите разницу?

209
00:08:25,039 --> 00:08:31,919
теперь персонаж игрока отображается в центре экрана

211
00:08:29,280 --> 00:08:34,800
Итак, первый шаг выполнен

212
00:08:31,919 --> 00:08:36,320
переходим к шагу два

214
00:08:36,320 --> 00:08:44,880
перейдем к этой GamePanel и создадим некоторые параметры карты мира

243
00:09:34,720 --> 00:09:42,720
как я уже сказал, вы можете изменять эти числа по своему усмотрению

246
00:09:43,120 --> 00:09:47,600
Я думаю, что этот класс GamePanel подходит

247
00:09:45,920 --> 00:09:53,200
так что давайте перейдем к классу TileManager

248
00:09:47,600 --> 00:09:58,880
и изменим размер этого mapTileNum.

251
00:09:56,160 --> 00:10:07,760
мы изменим это значение с maxScreenCol на maxWorldCol

254
00:10:04,640 --> 00:10:12,079
а это также maxWorldRow

256
00:10:09,360 --> 00:10:19,240
и давайте изменим путь к этому файлу

261
00:10:24,720 --> 00:10:29,279
и в этом методе loadMap, 

262
00:10:27,360 --> 00:10:35,519
мы изменим maxScreenCol на maxWorldCol

266
00:10:39,839 --> 00:10:48,959
и maxScreenRow на maxWorldRow

268
00:10:46,000 --> 00:10:52,079
так что, по сути, мы делаем здесь большой цикл

269
00:10:48,959 --> 00:10:58,959
Так что в предыдущем цикле размер экрана был границами

271
00:10:55,120 --> 00:11:01,200
но теперь границами является карта мира

272
00:10:58,959 --> 00:11:09,040
теперь мы переходим к методу draw и делаем некоторую расстановку

276
00:11:07,279 --> 00:11:16,000
и это будет немного сложнее, потому что мы реализуем функцию камеры

279
00:11:14,800 --> 00:11:20,160
сначала мы удалим эти x и y

281
00:11:17,600 --> 00:11:25,760
поэтому мы не будем использовать эти x и y в этом цикле.

283
00:11:22,720 --> 00:11:32,000
и удалим это, это и это.

287
00:11:32,320 --> 00:11:44,640
затем мы изменим эти col и row на worldCol и worldRow

292
00:11:43,200 --> 00:11:48,480
поэтому скопируйте этот worldCol и вставьте сюда

299
00:12:03,440 --> 00:12:12,639
и также давайте изменим maxScreenCol на maxWorldCol

306
00:12:17,839 --> 00:12:23,519
а теперь сложная часть 

307
00:12:21,519 --> 00:12:26,240
в конечном итоге, есть три вещи, которые мы хотим знать

309
00:12:24,639 --> 00:12:34,079
изображение плитки и где нарисовать плитку на экране

313
00:12:31,760 --> 00:12:38,880
и мы уже знаем, какое изображение плитки будет отображаться на экране

316
00:12:38,880 --> 00:12:46,240
и чтобы узнать эти x и y, мы набираем вот так:

344
00:13:30,399 --> 00:13:35,000
подождите... это не публично?

346
00:13:39,680 --> 00:13:43,600
почему я вижу ошибку

348
00:13:49,600 --> 00:13:53,680
о, хорошо, извините

349
00:13:51,199 --> 00:13:56,079
нам нужно установить это как общедоступное

352
00:13:58,240 --> 00:14:04,240
затем еще одна переменная

360
00:14:20,320 --> 00:14:25,600
почему я всегда так печатаю...

362
00:14:26,000 --> 00:14:34,480
и мы вставим эти screenX и screenY сюда.

365
00:14:35,360 --> 00:14:44,160
Позвольте мне объяснить эту часть

366
00:14:40,160 --> 00:14:47,199
сначала мы проверяем worldX плитки 

367
00:14:44,160 --> 00:14:48,000
то есть worldCol x tileSize

368
00:14:47,199 --> 00:14:49,519
так что

369
00:14:48,000 --> 00:14:56,399
если это плитка [0][0], 

372
00:14:54,160 --> 00:14:59,120
это будет 0 x 48 и 0 x 48.

374
00:14:57,760 --> 00:15:03,279
поэтому x и y также 0 0

376
00:15:00,959 --> 00:15:08,160
и если это плитка [1][0],

378
00:15:06,720 --> 00:15:09,680
что означает следующее

379
00:15:08,160 --> 00:15:18,399
тогда worldX будет 1 x 48, так что worldX будет 48

381
00:15:13,360 --> 00:15:20,639
а worldY все еще 0

382
00:15:18,399 --> 00:15:27,839
тогда нам нужно знать, где на экране нам нужно нарисовать это

384
00:15:24,240 --> 000:15:32,800
опять же, этот screenX отличается от worldX

386
00:15:29,839 --> 00:15:35,600
worldX - это положение на карте 

387
00:15:32,800 --> 00:15:39,360
а screenX - это место на экране, где мы его рисуем

389
00:15:37,360 --> 00:15:48,000
представьте, если игрок находится в worldX 500 и worldY 500

392
00:15:45,839 --> 00:15:55,920
то игрок находится на расстоянии 500 пикселей от этой плитки [0][0]

395
00:15:53,759 --> 00:15:57,120
допустим, это где-то здесь

396
00:15:55,920 --> 00:16:11,040
тогда эта плитка [0][0] должна быть нарисована на расстоянии 500 пикселей слева и 500 пикселей сверху от игрока

401
00:16:09,839 --> 00:16:22,000
поэтому мы вычитаем worldX и worldY игрока из worldX и worldY плитки.

406
00:16:19,680 --> 00:16:24,560
и это возвращает положение плитки на экране

408
00:16:23,440 --> 00:16:37,040
так что если позиция игрока 500:500, то экранная позиция этой плитки будет x минус 500 и y минус 500

412
00:16:35,680 --> 00:16:41,279
так что, по сути, он находится вне нашего игрового окна

414
00:16:40,079 --> 00:16:51,839
тогда почему мы добавляем screenX и screenY этого игрока?

418
00:16:48,240 --> 00:16:54,399
здесь есть небольшая загвоздка 

419
00:16:51,839 --> 00:17:01,519
поэтому помните, что положение игрока на экране всегда находится в центре экрана

421
00:16:57,120 --> 00:17:05,839
например, screenX 0 и screenY 0 означает верхний левый угол

424
00:17:04,640 --> 00:17:07,199
здесь

426
00:17:07,199 --> 00:17:12,079
и становится минусовой (отсюда)

427
00:17:10,640 --> 00:17:13,280
так что 0:0 здесь

428
00:17:12,079 --> 00:17:20,640
даже если игрок стоит в точке worldX 0 и worldY 0

431
00:17:19,520 --> 00:17:24,880
все равно он отображается в центре экрана 

433
00:17:22,480 --> 00:17:28,480
не здесь

434
00:17:24,880 --> 00:17:33,720
поэтому нам нужно компенсировать эту разницу

435
00:17:28,480 --> 00:17:33,720
поэтому мы добавляем это к расчету

436
00:17:34,559 --> 00:17:40,320
Добавив это, мы можем компенсировать разницу

437
00:17:37,520 --> 00:17:47,039
и мы можем получить правильные координаты для screenX и screenY этой плитки

439
00:17:43,600 --> 00:17:53,919
надеюсь, вы поняли, и все в порядке, даже если вы все еще чувствуете "э... что?".

442
00:17:51,440 --> 00:18:02,080
Я был таким же, мне потребовалось время, чтобы понять это.

445
00:17:58,960 --> 00:18:05,360
Так что пока все в порядке, просто скопируйте и вставьте этот код

446
00:18:02,080 --> 00:18:10,880
но я надеюсь, что в конце концов у вас получится, и я думаю, что получится.

448
00:18:08,400 --> 00:18:13,120
и я надеюсь, что моего объяснения было достаточно

449
00:18:10,880 --> 00:18:17,120
Да, это сложно

450
00:18:13,120 --> 00:18:20,240
так или иначе, мы выяснили, что у плитки есть screenX и screenY

452
00:18:18,080 --> 00:18:26,320
поэтому после рисования тайла мы увеличиваем worldCol на 1

454
00:18:23,440 --> 00:18:29,280
чтобы мы могли нарисовать следующую плитку

455
00:18:26,320 --> 00:18:32,880
и если worldCol достигнет этого maxWorldCol...

456
00:18:29,280 --> 00:18:33,919
да, мы рисуем один за другим

457
00:18:32,880 --> 00:18:38,960
и когда мы попадаем на эту плитку

460
00:18:38,960 --> 00:18:46,320
мы сбрасываем col и увеличиваем row, так что мы перемещаемся сюда

462
00:18:43,600 --> 00:18:48,720
и рисуем эту линию и эту линию...

465
00:18:51,039 --> 00:18:57,919
Хорошо, теперь это должно работать, так что давайте проверим.

467
00:18:55,440 --> 00:19:00,320
надеюсь, это работает

470
00:19:03,679 --> 00:19:09,160
итак, теперь мы исследуем мир

471
00:19:12,720 --> 00:19:22,360
вот карта мира, которую я создал

473
00:19:17,679 --> 00:19:22,360
конечно, столкновений еще нет

474
00:19:25,919 --> 00:19:31,039
так что это работает

475
00:19:28,240 --> 00:19:38,000
но мы можем добавить еще немного штрихов, чтобы улучшить эффективность рендеринга

477
00:19:35,200 --> 00:19:41,440
вы можете продолжать как есть 

478
00:19:38,000 --> 00:19:45,120
но я рекомендую вам сделать это, чтобы избежать медленной работы игры

481
00:19:45,120 --> 00:19:55,200
возможно вы заметили, но прямо сейчас этот цикл while рисует все тайлы на карте

483
00:19:52,480 --> 00:20:04,000
это означает, что он рисует плитки, которые мы не видим на экране.

486
00:20:01,440 --> 00:20:06,240
и это не так эффективно

487
00:20:04,000 --> 00:20:07,360
это все еще относительно небольшая карта

488
00:20:06,240 --> 00:20:13,760
но когда у вас очень большая карта, это может замедлить игру

491
00:20:12,720 --> 00:20:20,400
поэтому нам нужно рисовать только те плитки, которые мы можем видеть

494
00:20:18,080 --> 00:20:26,559
нам не нужно рисовать плитку, которая находится на расстоянии 500 пикселей от игрока

496
00:20:24,080 --> 00:20:28,960
так что это последний штрих

497
00:20:26,559 --> 00:20:34,400
На этом наша система рисования плитки будет завершена, так что, пожалуйста, оставайтесь со мной

499
00:20:32,960 --> 00:20:41,440
Итак, перед рисованием плитки мы добавляем этот оператор if

537
00:21:52,400 --> 00:22:03,520
и мы поместим метод drawImage в этот оператор if

541
00:22:01,120 --> 00:22:05,760
вот и все

542
00:22:03,520 --> 00:22:12,240
Что означает этот оператор if, в основном мы создаем границу

544
00:22:09,360 --> 00:22:15,039
которая проходит от центра экрана минус экранX игрока

545
00:22:12,240 --> 00:22:18,400
и плюс экран игрокаХ

547
00:22:17,280 --> 00:22:22,960
и минус player screenY, и плюс player screenY

549
00:22:22,000 --> 00:22:31,200
так что пока плитка находится в этих границах, мы рисуем ее

552
00:22:28,000 --> 00:22:31,200
так что давайте проверим это

553
00:22:31,520 --> 00:22:35,520
хорошо, вот так

557
00:22:44,720 --> 00:22:54,320
теперь мы видим, что программа рисует только плитки вокруг игрока

559
00:22:51,840 --> 00:23:03,280
но я думаю, что мы должны расширить границы немного больше, так как мы видим черный фон

563
00:23:00,799 --> 00:23:09,760
так почему бы нам не расширить эту границу на 1 плитку в каждую сторону

567
00:23:09,760 --> 00:23:15,280
чтобы сделать это, мы просто...

570
00:23:15,280 --> 00:23:22,400
мне почему-то не нравится этот формат...

573
00:23:22,400 --> 00:23:32,799
Итак, чтобы сделать это, мы добавляем worldX и tileSize

578
00:23:32,799 --> 00:23:42,159
а это...

585
00:23:53,520 --> 00:23:58,799
Хорошо, это должно быть нормально

586
00:23:55,760 --> 00:23:58,799
так что давайте проверим это

589
00:24:03,679 --> 00:24:07,840
теперь это выглядит так же, как и раньше

590
00:24:06,320 --> 00:24:17,919
но на самом деле это только отрисовка тайлов вокруг игрока, так что мы можем сократить дополнительную обработку

594
00:24:15,679 --> 00:24:24,159
Итак, теперь программа рисует карту мира, и мы можем перемещаться по ней

596
00:24:22,080 --> 00:24:29,520
но, конечно, столкновений пока не происходит

599
00:24:27,200 --> 00:24:32,480
чтобы каждая плитка была проходимой

601
00:24:30,880 --> 00:24:37,679
так что в следующий раз мы реализуем обнаружение столкновений

603
00:24:35,679 --> 00:24:40,679
спасибо за просмотр и до новых встреч

605
00:24:43,870 --> 00:24:50,559
[Music]так что каждая плитка проходима

